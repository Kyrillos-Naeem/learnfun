<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>موقع الامتحان</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="icon" href="logo.png" type="image/x-icon">
    <style>
        :root {
            /* Deepest Black Theme Palette */
            --bg-deep-dark: #050505;         
            --bg-dark-primary: #101010;     
            --bg-dark-secondary: #1c1c1c;   
            --bg-dark-tertiary: #2b2b2b;   
            
            --accent-primary: #00c6ff;     
            --accent-secondary: #00a9e0;   
            --accent-tertiary: #008ac7;   

            --text-primary: #fdfdfd;       
            --text-secondary: #e5e5e5;     
            --text-muted: #b3b3b3;         

            --border-color: #303030;       
            --border-strong-color: #4a4a4a; 

            --success-color: #28a745; 
            --success-background-tint: rgba(40, 167, 69, 0.07);
            --error-color: #dc3545;   
            --error-background-tint: rgba(220, 53, 69, 0.07);
            
            --warning-primary: #fbbf24;   
            --warning-secondary: #f59e0b;

            --shadow-color-light: rgba(200, 200, 200, 0.03); 
            --shadow-color-medium: rgba(200, 200, 200, 0.05);
            --shadow-sm: 0 3px 6px var(--shadow-color-light);
            --shadow-md: 0 6px 12px var(--shadow-color-medium);
            --shadow-lg: 0 12px 28px var(--shadow-color-medium), 0 8px 12px var(--shadow-color-light);
            --shadow-inset: inset 0 2px 4px rgba(0,0,0,0.6); 

            --border-radius-sm: 8px; 
            --border-radius-md: 14px; 
            --border-radius-lg: 20px;
            --border-radius-xl: 28px;

            --font-main: 'Tajawal', sans-serif;
            --transition-fast: all 0.2s ease-in-out;
            --transition-smooth: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-deep-dark);
            color: var(--text-primary);
            line-height: 1.75; 
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 25px 15px; 
            overflow-x: hidden;
        }

        .container {
            background-color: var(--bg-dark-primary);
            border-radius: var(--border-radius-xl);
            box-shadow: var(--shadow-lg);
            width: 100%;
            max-width: 880px; 
            padding: 40px 45px; 
            margin: 30px 0;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden; 
        }
         .container::before { 
            content: '';
            position: absolute;
            top: -100px;
            right: -100px;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(0, 198, 255, 0.02) 0%, rgba(0, 198, 255, 0) 60%);
            border-radius: 50%;
            pointer-events: none;
            z-index: 0;
            filter: blur(15px); 
        }
        main, header, footer {
            position: relative; 
            z-index: 1;
        }

        /* --- Screen Transitions --- */
        .screen {
            animation: fadeInScreen 0.6s var(--transition-smooth) forwards;
        }
        .screen.hidden { display: none !important; }

        @keyframes fadeInScreen {
            from { opacity: 0; transform: translateY(15px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        header {
            text-align: center;
            padding-bottom: 30px;
            margin-bottom: 35px;
            border-bottom: 1px solid var(--border-color);
        }

        header h1 {
            font-size: 2.6em; 
            font-weight: 900; 
            color: var(--accent-primary);
            letter-spacing: 1px; 
            margin-bottom: 20px;
            text-shadow: 0 0 18px rgba(0, 198, 255, 0.55); 
        }

        .timer {
            background-color: var(--bg-dark-secondary);
            color: var(--warning-primary);
            padding: 12px 25px;
            border-radius: var(--border-radius-md);
            font-size: 1.25em;
            font-weight: 700;
            display: inline-flex; 
            align-items: center;
            gap: 10px;
            border: 1px solid var(--border-strong-color);
            box-shadow: var(--shadow-md);
            transition: var(--transition-smooth);
        }
        .timer:hover {
            transform: scale(1.03);
            box-shadow: 0 5px 15px var(--shadow-color-medium);
        }
        .timer i { font-size: 1.2em; margin-left: 5px; }


        /* --- Welcome Screen --- */
        .welcome-screen { text-align: center; padding: 30px 0; }
        .welcome-screen .start-icon-container {
            width: 90px;
            height: 90px;
            background: linear-gradient(145deg, var(--accent-primary), var(--accent-tertiary));
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0 auto 30px auto;
            box-shadow: 0 0 25px rgba(0, 198, 255, 0.3);
            color: var(--bg-deep-dark);
            transition: transform 0.35s ease;
        }
        .welcome-screen .start-icon-container:hover {
            transform: rotate(10deg) scale(1.12);
        }
        .welcome-screen .start-icon-container i { font-size: 3em; }
        .welcome-screen h2 {
            font-size: 2.3em;
            color: var(--text-primary);
            margin-bottom: 20px;
            font-weight: 800;
        }
        .welcome-screen p {
            font-size: 1.1em;
            color: var(--text-secondary);
            margin-bottom: 18px;
            max-width: 650px;
            margin-left: auto;
            margin-right: auto;
        }
        .welcome-screen p strong { color: var(--accent-primary); font-weight: 700; }
        .welcome-screen .custom-credit {
            font-size: 0.95em;
            color: var(--text-muted);
            margin-top: 20px; /* Adjusted margin */
            margin-bottom: 25px; /* Added margin before buttons */
        }
        .welcome-actions { 
            margin-top: 25px;
            display: flex;
            flex-direction: column; 
            align-items: center;
            gap: 15px;
        }
        #view-old-results-btn {
            background: transparent;
            border-color: var(--text-muted);
            color: var(--text-muted);
            font-weight: 500; 
            padding: 10px 20px;
        }
        #view-old-results-btn:hover:not(:disabled) {
            background: var(--bg-dark-tertiary);
            border-color: var(--text-secondary);
            color: var(--text-secondary);
        }


        /* --- Question Container --- */
        .question-container { padding: 20px 0; }
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 12px 20px;
            background-color: var(--bg-dark-secondary);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-sm);
        }
        #question-number {
            font-size: 1.05em;
            font-weight: 700;
            color: var(--text-secondary);
        }
        .progress-bar-container {
            width: 70%; 
            height: 12px; 
            background-color: var(--bg-dark-tertiary);
            border-radius: 6px;
            overflow: hidden;
            box-shadow: var(--shadow-inset);
        }
        .progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--accent-tertiary) 0%, var(--accent-primary) 100%);
            border-radius: 6px;
            transition: width 0.55s cubic-bezier(0.23, 1, 0.32, 1); 
        }
        #question-text {
            font-size: 1.7em; 
            font-weight: 500; 
            color: var(--text-primary);
            margin-bottom: 35px;
            text-align: right;
            padding: 22px 25px;
            background-color: var(--bg-dark-secondary); 
            border-radius: var(--border-radius-lg);
            border-left: 4px solid var(--accent-primary); 
            box-shadow: var(--shadow-md);
        }
        .options-container { display: grid; grid-template-columns: 1fr; gap: 15px; }
        .option-item {
            background-color: var(--bg-dark-secondary);
            border: 1.5px solid var(--border-color); 
            border-radius: var(--border-radius-md);
            padding: 18px 22px; 
            cursor: pointer;
            transition: var(--transition-fast);
            display: flex;
            align-items: center;
            font-size: 1.15em;
            color: var(--text-secondary);
            box-shadow: var(--shadow-sm);
        }
        .option-item:hover {
            background-color: var(--bg-dark-tertiary);
            border-color: var(--accent-primary);
            color: var(--text-primary);
            transform: translateY(-3.5px) scale(1.005); 
            box-shadow: 0 3.5px 9px var(--shadow-color-medium);
        }
        .option-item input[type="radio"] { display: none; }
        .option-item .custom-radio {
            width: 25px; 
            height: 25px;
            border: 2.5px solid var(--text-muted); 
            border-radius: 50%;
            margin-left: 18px;
            flex-shrink: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: var(--transition-fast);
        }
        .option-item:hover .custom-radio { border-color: var(--accent-primary); }
        .option-item input[type="radio"]:checked + .custom-radio {
            border-color: var(--accent-primary);
            background-color: var(--accent-primary);
            box-shadow: 0 0 12px rgba(0, 198, 255, 0.65); 
        }
        .option-item input[type="radio"]:checked + .custom-radio::after {
            content: '\f00c'; 
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            font-size: 12.5px; 
            color: var(--bg-deep-dark);
        }
        .option-item.selected {
            background-color: var(--bg-dark-tertiary);
            border-color: var(--accent-primary) !important;
            color: var(--text-primary);
        }
        .option-item.selected .custom-radio {
             border-color: var(--accent-primary) !important;
             background-color: var(--accent-primary) !important;
             box-shadow: 0 0 12px rgba(0, 198, 255, 0.65) !important;
        }

        /* --- Navigation & Action Buttons --- */
        .navigation-buttons { display: flex; justify-content: space-between; margin-top: 35px; gap: 18px;}
        
        button, .modal-button { 
            padding: 13px 28px; 
            border-radius: var(--border-radius-md);
            cursor: pointer;
            font-size: 1.05em;
            font-weight: 800; 
            transition: var(--transition-smooth);
            font-family: var(--font-main);
            display: inline-flex;
            align-items: center;
            justify-content: center; 
            gap: 9px; 
            text-transform: uppercase;
            letter-spacing: 0.75px;
            border: 2.5px solid transparent; 
            position: relative; 
            overflow: hidden; 
        }
        
        button:not(.outline):not(.warning):not(#view-old-results-btn), 
        .modal-button:not(.cancel) { /* Primary buttons, excluding specific ones */
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: var(--bg-deep-dark); 
            box-shadow: 0 3.5px 10px rgba(0, 198, 255, 0.18), var(--shadow-sm);
        }
        button:not(.outline):not(.warning):not(#view-old-results-btn):hover:not(:disabled),
        .modal-button:not(.cancel):hover:not(:disabled) {
            background: linear-gradient(135deg, var(--accent-secondary), var(--accent-tertiary));
            transform: translateY(-2.5px) scale(1.025);
            box-shadow: 0 5.5px 14px rgba(0, 198, 255, 0.28), var(--shadow-md);
        }
        
        button:disabled, .modal-button:disabled {
            background: var(--bg-dark-tertiary) !important; 
            color: var(--text-muted) !important;
            cursor: not-allowed;
            opacity: 0.55; 
            box-shadow: none !important;
            border-color: var(--bg-dark-tertiary) !important;
        }

        #submit-btn { 
            background: linear-gradient(135deg, var(--success-color), #1e7e34); 
            color: #fff; 
        }
        #submit-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #1e7e34, #155d27); 
        }
        
        button i, .modal-button i { font-size: 1em; }
        
        /* --- Results Container --- */
        .results-container { text-align: center; padding: 30px 0; }
        .results-container .result-actions {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap; 
            gap: 15px; 
            margin-top: 25px;
        }
        .results-container .result-actions button {
            min-width: 200px; 
        }

        /* Review Button - Outline Style Refined */
        #review-btn {
            background: transparent;
            border-color: var(--accent-primary); 
            color: var(--accent-primary);
            box-shadow: none;
        }
        #review-btn:hover:not(:disabled) {
            background: var(--accent-primary);
            color: var(--bg-deep-dark);
            border-color: var(--accent-primary);
            box-shadow: 0 5.5px 14px rgba(0, 198, 255, 0.28); 
        }

        /* Retake Button - Warning Style Refined */
        #retake-btn {
            background: linear-gradient(135deg, var(--warning-primary), var(--warning-secondary));
            color: var(--bg-deep-dark); 
            border-color: transparent; 
            box-shadow: 0 3.5px 10px rgba(251, 191, 36, 0.18), var(--shadow-sm);
        }
        #retake-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, var(--warning-secondary), #d97706); 
            box-shadow: 0 5.5px 14px rgba(251, 191, 36, 0.28), var(--shadow-md);
        }


        .results-container h2 {
            font-size: 2.6em;
            color: var(--accent-primary);
            margin-bottom: 30px;
            font-weight: 800;
        }
        .results-container .score-display {
            background-color: var(--bg-dark-secondary);
            padding: 28px 32px;
            border-radius: var(--border-radius-lg);
            margin-bottom: 35px;
            border: 1px solid var(--border-strong-color);
            box-shadow: var(--shadow-md);
        }
        .results-container p {
            font-size: 1.2em;
            margin-bottom: 15px;
            color: var(--text-secondary);
        }
        .results-container p span, .results-container p#percentage {
            font-weight: 700;
            color: var(--text-primary);
            font-size: 1.3em;
        }
         .results-container p#percentage {
            color: var(--success-color); 
            font-size: 1.9em; 
            margin-top: 15px;
            display: block; 
         }
         .results-container .back-to-welcome-btn { 
            margin-top: 20px;
            background: var(--bg-dark-tertiary);
            color: var(--text-secondary);
         }
         .results-container .back-to-welcome-btn:hover {
            background: var(--border-strong-color);
            color: var(--text-primary);
         }


        /* --- Review Container --- */
        .review-container { padding: 20px 0; }
        .review-container h2 {
            font-size: 2.3em;
            color: var(--accent-primary);
            margin-bottom: 35px;
            text-align: center;
            font-weight: 800;
        }
        .review-list {
            max-height: 420px; 
            overflow-y: auto;
            padding: 4px 12px 4px 4px; 
            margin-right: -12px; 
        }
        .review-list::-webkit-scrollbar { width: 8px; }
        .review-list::-webkit-scrollbar-track { background: var(--bg-dark-tertiary); border-radius: 4px; }
        .review-list::-webkit-scrollbar-thumb { background: var(--accent-secondary); border-radius: 4px; }
        .review-list::-webkit-scrollbar-thumb:hover { background: var(--accent-primary); }

        .review-item {
            background-color: var(--bg-dark-secondary);
            border-radius: var(--border-radius-md);
            padding: 20px 25px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-md);
            transition: var(--transition-smooth);
            border-left: 6px solid var(--border-strong-color); 
        }
        .review-item:hover { transform: scale(1.012) translateX(4px); box-shadow: var(--shadow-lg); }
        
        .review-item-correct {
            border-left-color: var(--success-color) !important; 
            background-color: var(--success-background-tint); 
        }
        .review-item-incorrect {
            border-left-color: var(--error-color) !important; 
            background-color: var(--error-background-tint); 
        }
        .review-item-unanswered { 
            border-left-color: var(--text-muted) !important;
        }

        .review-item p { margin-bottom: 10px; font-size: 1.05em; }
        .review-item .question-text-review {
            font-weight: 700; 
            color: var(--text-primary);
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        .review-item .your-answer-review, .review-item .correct-answer-review {
            padding: 7px 10px;
            border-radius: var(--border-radius-sm);
            display: block; 
            margin-top: 8px;
            font-weight: 500;
            border: 1px dashed transparent; 
        }
        .review-item-incorrect .your-answer-review { 
            color: var(--error-color);
            border-color: rgba(220, 53, 69, 0.4); 
        }
        .review-item-correct .correct-answer-review { 
            color: var(--success-color);
        }
         .review-item-incorrect .correct-answer-review { 
            color: var(--success-color);
            border-color: rgba(40, 167, 69, 0.4);
        }


        #back-to-results-btn { margin-top: 30px; display: block; margin-left: auto; margin-right: auto; }

        /* --- Custom Modal --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9); 
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.35s ease, visibility 0s linear 0.35s;
        }
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
            transition: opacity 0.35s ease;
        }
        .modal-content {
            background-color: var(--bg-dark-primary);
            padding: 35px 40px; 
            border-radius: var(--border-radius-lg);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); 
            text-align: center;
            width: 90%;
            max-width: 480px; 
            border: 1px solid var(--border-strong-color);
            transform: scale(0.92) translateY(15px);
            transition: transform 0.35s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.3s ease; 
        }
        .modal-overlay.active .modal-content {
            transform: scale(1) translateY(0px);
        }
        .modal-title {
            font-size: 1.7em;
            font-weight: 800;
            color: var(--accent-primary);
            margin-bottom: 18px;
        }
        .modal-message {
            font-size: 1.1em;
            color: var(--text-secondary);
            margin-bottom: 30px;
            line-height: 1.65;
        }
        .modal-actions {
            display: flex;
            justify-content: center; 
            gap: 15px;
        }
        .modal-button.cancel { 
            background: var(--bg-dark-tertiary);
            color: var(--text-secondary);
            border-color: var(--bg-dark-tertiary);
        }
        .modal-button.cancel:hover {
            background: var(--border-strong-color);
            color: var(--text-primary);
            border-color: var(--border-strong-color);
        }


        /* --- Footer --- */
        footer {
            text-align: center;
            padding-top: 30px;
            margin-top: 35px;
            border-top: 1px solid var(--border-color);
            color: var(--text-muted);
            font-size: 0.9em;
            font-weight: 400; 
        }
        footer p { opacity: 0.65; }
        footer .made-by {
            color: var(--accent-primary);
            font-weight: 700;
        }

        /* --- Responsive Adjustments --- */
        @media (max-width: 768px) {
            .container { padding: 30px 25px; margin: 20px 0; }
            header h1 { font-size: 2.1em; }
            .timer { font-size: 1.1em; padding: 10px 20px; }
            .welcome-screen h2 { font-size: 1.9em; }
            #question-text { font-size: 1.45em; padding: 20px; }
            .option-item { padding: 16px 20px; font-size: 1.1em; }
            button, .modal-button { padding: 12px 22px; font-size: 1em; }
            .results-container h2 { font-size: 2.2em; }
            .review-container h2 { font-size: 1.9em; }
            .modal-title { font-size: 1.5em;}
            .modal-message { font-size: 1em;}
            .results-container .result-actions button { min-width: 180px; }
        }
        @media (max-width: 480px) {
            body { padding: 10px; }
            .container { padding: 25px 15px; }
            header h1 { font-size: 1.8em; }
            .timer { font-size: 1em; padding: 8px 15px; }
            #question-text { font-size: 1.25em; margin-bottom: 25px; padding: 18px; }
            .option-item { font-size: 1em; padding: 14px; }
            .option-item .custom-radio { margin-left: 12px; width: 22px; height: 22px;}
            .navigation-buttons { flex-direction: column; gap: 12px; }
            .navigation-buttons button { width: 100%; }
            .results-container .result-actions { flex-direction: column; }
            .results-container .result-actions button { width: 100%; min-width: unset; margin: 8px 0;}
            .welcome-screen .start-icon-container { width: 70px; height: 70px; margin-bottom: 20px; }
            .welcome-screen .start-icon-container i { font-size: 2.5em; }
            .welcome-actions button { width: 90%; max-width: 300px;} 
            .review-list { padding-right: 8px; margin-right: -8px;}
            .modal-content { padding: 25px 20px;}
            .modal-actions { flex-direction: column; }
            .modal-actions .modal-button { width: 100%; }
        }

    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>الاختبار الشامل المتقدم</h1>
            <div class="timer" id="timer"><i class="fa-solid fa-clock-rotate-left"></i> الزمن المتبقي: 60:00</div>
        </header>

        <main id="exam-content">
            <div class="welcome-screen screen" id="welcome-screen">
                <div class="start-icon-container">
                    <i class="fa-solid fa-user-astronaut"></i>
                </div>
                <h2>مرحباً بك أيها المستكشف!</h2>
                <p>انطلق في رحلة معرفية مع 60 سؤالاً مصممة لاختبار حدود فهمك.
                    التركيز هو مفتاحك للنجاح.
                </p>
                <p>لديك <strong id="welcome-time-duration">60 دقيقة</strong> لإكمال التحدي. حظاً موفقاً!</p>
                <p class="custom-credit">تم عمله بواسطة : بولا نعيم</p>
                <p class="custom-credit">تحت اشراف : ابانوب جورج</p>
                <div class="welcome-actions">
                    <button id="start-exam-btn"><i class="fa-solid fa-shuttle-space"></i> ابدأ الرحلة المعرفية</button>
                    <button id="view-old-results-btn" class="outline"><i class="fa-solid fa-history"></i> عرض النتائج السابقة</button>
                </div>
            </div>

            <div class="question-container screen hidden" id="question-container">
                <div class="question-header">
                    <span id="question-number">السؤال 1/60</span>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="progress-bar"></div>
                    </div>
                </div>
                <h2 id="question-text">نص السؤال يظهر هنا...</h2>
                <div class="options-container" id="options-container">
                    <!-- Options loaded by JS -->
                </div>
                <div class="navigation-buttons">
                    <button id="prev-btn" disabled><i class="fa-solid fa-chevron-left"></i> السؤال السابق</button>
                    <button id="next-btn">السؤال التالي <i class="fa-solid fa-chevron-right"></i></button>
                    <button id="submit-btn" class="hidden"><i class="fa-solid fa-paper-plane"></i> إنهاء وتسليم</button>
                </div>
            </div>

            <div class="results-container screen hidden" id="results-container">
                <h2 id="results-title"><i class="fa-solid fa-medal"></i> تقرير الأداء النهائي</h2>
                <div class="score-display">
                    <p>عدد الأسئلة التي تمت الإجابة عليها: <span id="answered-count">0</span> من <span id="results-total-q-count1">60</span></p>
                    <p>مجموع النقاط (الإجابات الصحيحة): <span id="score">0</span> / <span id="results-total-q-count2">60</span></p>
                    <p id="percentage">النسبة المئوية للإتقان: 0%</p>
                    <p id="old-result-timestamp" class="hidden" style="font-size: 0.9em; color: var(--text-muted); margin-top: 10px;"></p>
                </div>
                <div class="result-actions">
                    <button id="review-btn" class="hidden"><i class="fa-solid fa-magnifying-glass-chart"></i> تحليل الإجابات</button>
                    <button id="retake-btn"><i class="fa-solid fa-repeat"></i> خوض التحدي مجدداً</button>
                    <button id="back-to-welcome-btn" class="hidden outline"><i class="fa-solid fa-home"></i> العودة للرئيسية</button>
                </div>
            </div>

            <div class="review-container screen hidden" id="review-container">
                <h2><i class="fa-solid fa-microscope"></i> المراجعة الدقيقة للإجابات</h2>
                <div class="review-list" id="review-list">
                    <!-- Review items loaded by JS -->
                </div>
                <button id="back-to-results-btn"><i class="fa-solid fa-arrow-left-long"></i> العودة لتقرير الأداء</button>
            </div>
        </main>
        <footer>
            <p>2025 © <span class="made-by">Made by BeboNaiem</span></p>
        </footer>
    </div>

    <!-- Custom Modal for Confirmation -->
    <div class="modal-overlay hidden" id="confirmation-modal-overlay">
        <div class="modal-content">
            <h3 class="modal-title" id="modal-title-text">تأكيد الإنهاء</h3>
            <p class="modal-message" id="modal-message-text">هل أنت متأكد من رغبتك في إنهاء الاختبار وتسليم إجاباتك؟ لا يمكنك التراجع بعد ذلك.</p>
            <div class="modal-actions">
                <button class="modal-button cancel" id="modal-cancel-btn"><i class="fa-solid fa-ban"></i> إلغاء الأمر</button>
                <button class="modal-button" id="modal-confirm-btn"><i class="fa-solid fa-circle-check"></i> نعم، تأكيد الإنهاء</button>
            </div>
        </div>
    </div>

    <script>
        // Raw content from qq.txt 
        const rawQuestionsText = `
تمام، إليك 60 سؤالاً متنوعاً بين الصح والخطأ والاختيار من متعدد، مع الإجابات، مستمدة من المصادر التي قدمتها:

**سؤال 1:** المهارة هي مجموعة المعارف والخبرات والقدرات الشخصية التي يجب توافرها عند شخص ما لإنجاز عمل معين.
**الإجابة:** **صح**

**سؤال 2:** المهارات اللينة هي مهارات ملموسة يتم اكتسابها من خلال التعليم والممارسة والتكرار.
**الإجابة:** **خطأ** (هذا تعريف المهارات الصعبة أو العملية)

**سؤال 3:** أي من أنواع المهارات التالية تتطلب أداءها توظيف العقل والتفكير؟
أ. النفس حركية
ب. الحس حركية
ج. الاجتماعية
د. **العقلية**
**الإجابة:** **د. العقلية**

**سؤال 4:** قياس المهارات العملية (الأدائي) يعتمد فقط على الناتج النهائي للعمل المطلوب.
**الإجابة:** **خطأ** (يعتمد على صحة ودقة الأداء في كل خطوة بالإضافة للناتج النهائي والزمن)

**سؤال 5:** أي من أساليب قياس المهارات يستخدم لتقويم بعض الجوانب التي تتطلب مواقف عملية؟
أ. أسلوب الملاحظة المنتظمة
ب. اختبارات التعرف
ج. اختبارات الأداء
د. **الاختبارات العملية**
**الإجابة:** **د. الاختبارات العملية**

**سؤال 6:** من خصائص المهارة أنها خليط من الاستجابات والسلوكيات العقلية والاجتماعية والحركية.
**الإجابة:** **صح**

**سؤال 7:** أول خطوة في اكتساب المهارة هي ممارسة المهارة بشكل فعلي.
**الإجابة:** **خطأ** (أول خطوة هي شرح المهارة المراد تعلمها)

**سؤال 8:** أي مرحلة في تعلم المهارة تتضمن التمثيل الذهني والاستعداد لخطوات المهارة الأدائية؟
أ. المعرفة العقلية
ب. **الاستعداد والتمثيل الذهني**
ج. الممارسة الفعلية للمهارة
د. شرح المهارة
**الإجابة:** **ب. الاستعداد والتمثيل الذهني**

**سؤال 9:** الوسيلة التعليمية هي كل ما يستخدم لتحقيق غاية، وليست غاية في ذاتها.
**الإجابة:** **صح**

**سؤال 10:** الوسائل التعليمية البصرية تعتمد على حاسة السمع.
**الإجابة:** **خطأ** (تعتمد على حاسة البصر)

**سؤال 11:** أي من تصنيفات الوسائل التعليمية التالية تعتمد على التفاعل بين المتعلم والتقنية مثل الكمبيوتر والإنترنت؟
أ. الوسائل البصرية
ب. الوسائل السمعية
ج. الوسائل السمعية البصرية
د. **الوسائل التفاعلية**
**الإجابة:** **د. الوسائل التفاعلية**

**سؤال 12:** حسب تصنيف الوسائل التعليمية، المعارض والمتاحف تعتبر من الوسائل السمعية.
**الإجابة:** **خطأ** (من الوسائل البصرية)

**سؤال 13:** المادة التعليمية هي الأساس في الوسيلة التعليمية باعتبارها المصدر الحقيقي للتعلم.
**الإجابة:** **صح**

**سؤال 14:** الجهاز التعليمي هو طريقة لعرض أو نقل المحتوى العلمي الذي تحمله المادة التعليمية.
**الإجابة:** **صح**

**سؤال 15:** أي مما يلي يُعد من أهمية الوسائل التعليمية؟
أ. تجعل التعليم أكثر صعوبة
ب. تقلل من تفاعل الطلاب
ج. تزيد من التجريد واللفظية لدى الطلاب
د. **تبسط المفاهيم وتوضح المعلومات المجردة**
**الإجابة:** **د. تبسط المفاهيم وتوضح المعلومات المجردة**

**سؤال 16:** من أسس ومعايير اختيار الوسيلة التعليمية أن تكون مكلفة جداً لضمان جودتها.
**الإجابة:** **خطأ** (يجب أن تكون اقتصادية وغير مكلفة)

**سؤال 17:** أول خطوة في خطوات تصميم الوسائل التعليمية هي تحديد خصائص الفئة المستهدفة.
**الإجابة:** **خطأ** (أول خطوة هي تحديد الأهداف التعليمية العامة)

**سؤال 18:** أي من الخطوات التالية في تصميم الوسائل التعليمية تأتي قبل صياغة الأهداف السلوكية؟
أ. تحليل المحتوى التعليمي
ب. تحديد استراتيجية التعلم
ج. تحديد نوع الوسيلة والخامات
د. **جميع ما سبق**
**الإجابة:** **أ. تحليل المحتوى التعليمي** (الخطوات بالترتيب: تحديد الأهداف العامة، تحديد خصائص الفئة، مراعاة التفريد، تحليل المحتوى، صياغة الأهداف السلوكية)

**سؤال 19:** شفافيات الحاسب تتطلب مهارة خاصة جداً لإنتاجها.
**الإجابة:** **خطأ** (لا تتطلب مهارة خاصة عند إنتاجها)

**سؤال 20:** عند إنتاج شفافيات الحاسب، يجب الطباعة على الجهة الملساء من الشفافية.
**الإجابة:** **خطأ** (على الجهة الخشنة)

**سؤال 21:** لوحة الجيوب هي لوحة مستوية تحتوي على جيوب أفقية تستخدم لتثبيت البطاقات.
**الإجابة:** **صح**

**سؤال 22:** عند إنتاج بطاقات اللوحة الوبرية، يجب عدم تكثيف استخدام اللون.
**الإجابة:** **صح**

**سؤال 23:** أي مما يلي لا يُعد من المعايير التي يجب أن يأخذها المعلم في اعتباره عند إنتاج بطاقات اللوحة الوبرية؟
أ. عدم استخدام وتكثيف اللون
ب. توزيع الصنفرة الخشنة بنظام معين
ج. الحفاظ على تباين الألوان المستخدمة
د. **الالتزام بشكل محدد وثابت للبطاقة**
**الإجابة:** **د. الالتزام بشكل محدد وثابت للبطاقة**

**سؤال 24:** الرسوم التعليمية هي تلك المواد المرسومة والرموز الخطية التي تم تصميمها من أجل تلخيص المعلومات وتفسيرها.
**الإجابة:** **صح**

**سؤال 25:** مصور التركيب الداخلي يوضح تسلسلاً زمنياً لأحداث تاريخية.
**الإجابة:** **خطأ** (مصور التتابع الزمني يوضح ذلك، مصور التركيب الداخلي يوضح ما بداخل الكائن)

**سؤال 26:** أي من أنواع المصورات التالية يوضح التسلسل الإداري أو الهيكل التنظيمي؟
أ. مصور الشكل الظاهري
ب. مصور المقارنة
ج. مصور الأصول (التجميعي)
د. **مصور العلاقات الوظيفية**
**الإجابة:** **د. مصور العلاقات الوظيفية**

**سؤال 27:** من المعايير العلمية التربوية للرسم التعليمي إعداده بمساحة صغيرة تكفي لعدد محدود من الطلاب.
**الإجابة:** **خطأ** (بمساحة كافية تسمح لجميع الطلاب بالمشاهدة بسهولة)

**سؤال 28:** من المعايير الفنية للرسم التعليمي استخدام ألوان جذابة حتى لو لم تبرز الأجزاء العلمية.
**الإجابة:** **خطأ** (اختيار الألوان المناسبة التي تبرز الأجزاء العلمية أولاً ثم الناحية الجمالية)

**سؤال 29:** العينة هي جزء من شيء أو موضوع يمثل خصائصه، وقد تكون حية أو ميتة أو جماداً.
**الإجابة:** **صح**

**سؤال 30:** الحفظ الجاف هو أحدث طرق حفظ العينات.
**الإجابة:** **خطأ** (هو أقدم طرق الحفظ)

**سؤال 31:** أي من طرق حفظ العينات ينطبق فقط على النوع الثاني من العينات (الذي يطرأ عليه بعض التغير في خصائصه)؟
أ. التحنيط
ب. التصبير
ج. حفظ الهياكل العظمية
د. **كل ما سبق**
**الإجابة:** **د. كل ما سبق** (الحفظ الجاف والرطب المذكوران هما لطرق حفظ النوع الثاني)

**سؤال 32:** الحقيبة التعليمية تسمح للمتعلم بالتفاعل حسب سرعته ومدى إتقانه للأهداف.
**الإجابة:** **صح**

**سؤال 33:** الحقيبة التعليمية تهدف إلى تحقيق التنمية المعرفية فقط.
**الإجابة:** **خطأ** (تهدف لتطوير مفاهيم ومهارات)

**سؤال 34:** أي من التالي يُعد من أهمية الحقائب التعليمية؟
أ. تحد من حرية اختيار الأنشطة
ب. تعيق التعلم الذاتي
ج. تزيد من مشكلة زيادة عدد الطلاب وقلة المعلمين
د. **تساعد في حل مشكلة زيادة عدد الطلاب مع قلة المعلمين المؤهلين**
**الإجابة:** **د. تساعد في حل مشكلة زيادة عدد الطلاب مع قلة المعلمين المؤهلين**

**سؤال 35:** تحليل المهمات في خطوات تصميم الحقائب التعليمية يعني تحليل الحقيبة إلى مكوناتها الأساسية.
**الإجابة:** **صح**

**سؤال 36:** المصادر في الحقيبة التعليمية لا تتنوع بل تكون ثابتة في جميع الحقائب.
**الإجابة:** **خطأ** (تتنوع حسب طبيعة الحقيبة ومتطلباتها)

**سؤال 37:** أي من أنواع المصادر الأساسية في الحقيبة التعليمية تشمل غرف المشاهدة وقاعات العرض والمختبرات؟
أ. المعدات
ب. **التسهيلات المكانية**
ج. الأفراد المساعدون
د. الزمن
**الإجابة:** **ب. التسهيلات المكانية**

**سؤال 38:** الأهداف الأدائية في الحقيبة التعليمية تصف الأداء النهائي للمتعلم عند انتهاء العمل بالحقيبة أو وحداتها.
**الإجابة:** **صح**

**سؤال 39:** مرحلة التحديد في مهارات إنتاج برمجيات الكمبيوتر التعليمية تشمل فقط تحديد حاجات المتعلمين.
**الإجابة:** **خطأ** (تشمل أيضاً تحديد المهام التعليمية، خصائص المتعلمين، السلوك المدخلي، والمتطلبات القبلية)

**سؤال 40:** أي من أنواع تنظيم المحتوى التعليمي في برمجيات الكمبيوتر يعتمد على الانتقال من الصعب إلى السهل؟
أ. تنظيم منطقي
ب. **تنظيم استقرائي**
ج. تنظيم سيكولوجي
د. تنظيم تاريخي
**الإجابة:** **ب. تنظيم استقرائي**

**سؤال 41:** تنظيم المحتوى السيكولوجي يعتمد على المجتمع وثقافته في اشتقاق أهداف ومحتوى التعليم.
**الإجابة:** **خطأ** (هذا تعريف التنظيم الاجتماعي، التنظيم السيكولوجي يعرض المادة وفقاً لقدرات واستعدادات المتعلمين)

**سؤال 42:** من المبادئ العامة لتصميم شاشات العرض في البرمجيات التعليمية مراعاة الاتساق بين المساحات المخصصة للعرض داخل الشاشة.
**الإجابة:** **صح**

**سؤال 43:** أي من أنواع الشاشات في الحقيبة التعليمية تستخدم لنقل المستخدم بين أجزاء البرنامج؟
أ. شاشة التقديم
ب. شاشة إرشادية
ج. **شاشة رابطة**
د. شاشة ممارسة
**الإجابة:** **ج. شاشة رابطة**

**سؤال 44:** كتابة النص التعليمي للبرمجية لا تشمل الجانب المسموع.
**الإجابة:** **خطأ** (تشمل الجانب المرئي والمسموع)

**سؤال 45:** مرحلة التوزيع في إنتاج برمجيات الكمبيوتر تعني توظيف البرمجية في المنظمات التعليمية.
**الإجابة:** **خطأ** (مرحلة الاستخدام تعني التوظيف، مرحلة التوزيع تعني نشر وتوزيع البرمجية على أكثر من مؤسسة)

**سؤال 46:** Google Calendar يتيح إنشاء تقاويم شخصية ومشتركة ويتكامل بسلاسة مع بريد جوجل.
**الإجابة:** **صح**

**سؤال 47:** أي من تطبيقات جوجل التعليمية يعتبر مستودع تخزيني مجاني ويتيح العمل التعاوني على مشروع واحد؟
أ. Gmail
ب. Google Sites
ج. Google Calendar
د. **Google Docs**
**الإجابة:** **د. Google Docs**

**سؤال 48:** من مميزات تطبيقات جوجل التعليمية أنها آمنة فكل شيء يبقى ضمن النطاق المسجل.
**الإجابة:** **صح**

**سؤال 49:** من عيوب التدوين المرئي أنه غير مكلف.
**الإجابة:** **خطأ** (هو غير مكلف، وهذا من مميزاته وليس عيوبه)

**سؤال 50:** أي من أنواع التدوين المرئي يجمع بين الصوت والصور الثابتة مثل الباوربوينت؟
أ. الفيديو
ب. **الصوت والصور الثابتة**
ج. الفيديو بودكاست
د. فيديو كاست
**الإجابة:** **ب. الصوت والصور الثابتة**

**سؤال 51:** الانفوجرافيك يتميز بأنه يعرض المعلومات المعقدة بطريقة صعبة ومعقدة.
**الإجابة:** **خطأ** (بطريقة سهلة وبسيطة)

**سؤال 52:** أي مما يلي لا يُعد من خصائص الانفوجرافيك المتحرك؟
أ. الترميز والاختصار
ب. الاتصال البصري
ج. القابلية للمشاركة
د. **الافتقار إلى القدرة الإثرائية**
**الإجابة:** **د. الافتقار إلى القدرة الإثرائية** (قدرته الإثرائية من خصائصه)

**سؤال 53:** من معايير تصميم الانفوجرافيك دمج الصور والرسومات واتباع البساطة في المعلومة المعروضة.
**الإجابة:** **صح**

**سؤال 54:** المقررات الإلكترونية لا تتيح التفاعل المتزامن وغير المتزامن مع أستاذ المادة.
**الإجابة:** **خطأ** (تتيح ذلك)

**سؤال 55:** أي من مكونات المقرر الإلكتروني يُستخدم لتحديد مواعيد الاختبارات، التسجيل، الاجتماعات، ومواعيد تسليم الواجبات؟
أ. لوحة الإعلانات
ب. غرفة الحوار
ج. **التقويم الدراسي**
د. صندوق الواجبات
**الإجابة:** **ج. التقويم الدراسي**

**سؤال 56:** من مواصفات المقرر الإلكتروني الجيد أن تكون لغته صعبة ومليئة بالمصطلحات المعقدة.
**الإجابة:** **خطأ** (يجب استخدام جمل واضحة وقصيرة، وخلو المحتوى من التحيز والأخطاء اللغوية والإملائية)

**سؤال 57:** الاختبارات الإلكترونية هي أسلوب اختباري تقييمي مطبق باستخدام الحاسوب، تُسجل فيه الإجابات ويُصحح إلكترونياً.
**الإجابة:** **صح**

**سؤال 58:** أي من أنواع الاختبارات الإلكترونية التالية يُستخدم لقياس قدرة المتعلم على اختيار الإجابة الصحيحة من بين عدة خيارات؟
أ. الصواب والخطأ
ب. المزاوجة
ج. ملء الفراغات
د. **الاختيار من متعدد**
**الإجابة:** **د. الاختيار من متعدد**

**سؤال 59:** من مميزات الاختبارات الإلكترونية أنها لا توفر تغذية راجعة فورية.
**الإجابة:** **خطأ** (توفر تغذية راجعة فورية)

**سؤال 60:** من عيوب الاختبارات الإلكترونية ارتفاع تكلفة البنية الأساسية ونقص بنوك الأسئلة العربية.
**الإجابة:** **صح**


سؤال 61: المهارة في التربية يقصد بها الماهر، وتعني أنها متنوعة وتشمل جميع الجوانب المادية وغير المادية.
الإجابة: صح
سؤال 62: المهارة اللغوية تشمل:
أ. الاستماع والتحدث فقط
ب. القراءة والكتابة فقط
ج. الاستماع والتحدث والقراءة والكتابة
د. التفاعل مع الآخرين فقط
الإجابة: ج. الاستماع والتحدث والقراءة والكتابة
سؤال 63: المهارات الصعبة (العملية) هي مهارات غير ملموسة تتعلق بالسلوكيات الشخصية.
الإجابة: خطأ (هذا تعريف المهارات اللينة، المهارات الصعبة هي فنية يتم اكتسابها بالتعليم والممارسة)
سؤال 64: أي من أنواع المهارات التالية مثال عليه استخدام الآلات الموسيقية والتعبير بالأداء التمثيلي؟
أ. العقلية
ب. النفس حركية
ج. الحس حركية
د. الاجتماعية
الإجابة: ب. النفس حركية
سؤال 65: قياس الجانب المعرفي للمهارة يتم عن طريق اختبارات تحريرية بالورقة والقلم.
الإجابة: صح
سؤال 66: أي من أساليب قياس المهارات يهتم بأداء الطلاب الفعلي للمهارات ويعتبر من أهم أساليب التقويم في المهارات العملية؟
أ. اختبارات التعرف
ب. اختبارات الأداء
ج. أسلوب الملاحظة المنتظمة
د. اختبارات الإبداع
الإجابة: ج. أسلوب الملاحظة المنتظمة
سؤال 67: من خصائص المهارة أنها تتسم بالدقة والسرعة فقط.
الإجابة: خطأ (تشمل أيضاً القدرة على القيام بعمل ما، خليط من الاستجابات، الأداء المهاري، والأداء المعياري للفرد)
سؤال 68: آخر خطوة في اكتساب المهارة هي:
أ. شرح المهارة
ب. ملاحظة المتعلم لأداء المهارة
ج. ممارسة المتعلم للمهارة تحت توجيه
د. التركيز على العملية كلها من البداية حتى النهاية
الإجابة: د. التركيز على العملية كلها من البداية حتى النهاية
سؤال 69: المعرفة العقلية في خطوات تعلم المهارة تشمل التعامل مع المعلومات والمفاهيم بشكل عملي تطبيقي.
الإجابة: خطأ (بشكل نظري عن طريق العقل)
سؤال 70: الممارسة الفعلية للمهارة في خطوات تعلم المهارة تتضمن القيام ببعض الحركات الأدائية بشكل عشوائي.
الإجابة: خطأ (القيام بجميع الحركات الأدائية للمهارة بشكل صحيح وبتسلسله المحدد)
سؤال 71: مفهوم الوسيلة التعليمية يقتصر على الأدوات التي يستخدمها المعلم بشكل مباشر في الفصل.
الإجابة: خطأ (هي كل أداة يستخدمها المعلم لدعم عملية التعليم، سواء كانت مباشرة أو غير مباشرة)
سؤال 72: أي من الوسائل التالية يعتبر من الوسائل السمعية البصرية (Audio Visual Aids)؟
أ. الراديو
ب. الصور الفوتوغرافية
ج. الأفلام الناطقة
د. الكمبيوتر بدون صوت
الإجابة: ج. الأفلام الناطقة
سؤال 73: المكونان الرئيسيان للوسائل التعليمية هما:
أ. المواقف والأشخاص
ب. المواد التعليمية والمحتوى العلمي
ج. المواد التعليمية والأجهزة والأدوات التعليمية
د. الأجهزة التعليمية والمواقف
الإجابة: ج. المواد التعليمية والأجهزة والأدوات التعليمية
سؤال 74: المادة العلمية (المحتوى) هي مجموعة معلومات نوعية مرتبطة بمجال دراسي معين ويراد إكسابها للمتعلمين.
الإجابة: صح
سؤال 75: الأجهزة والأدوات التعليمية هي المادة الخام التي تحمل المحتوى التعليمي.
الإجابة: خطأ (هي المكونات المادية التي تستخدم في عرض ونقل المادة العلمية)
سؤال 76: العلاقة الصحيحة بين مكونات الوسيلة هي: مادة خام + جهاز تعليمي = وسيلة تعليمية.
الإجابة: خطأ (مادة خام + مادة علمية = مادة تعليمية؛ ثم مادة تعليمية + أداة أو جهاز تعليمي = وسيلة تعليمية)
سؤال 77: أي مما يلي لا يُعد من أهمية الوسائل التعليمية؟
أ. تسهل حفظ المعلومات
ب. توفر الوقت والجهد للمعلم
ج. تجعل التعلم فردياً بشكل كامل وتلغي دور المعلم
د. تتغلب على حدود الزمان والمكان
الإجابة: ج. تجعل التعلم فردياً بشكل كامل وتلغي دور المعلم
سؤال 78: من أسس ومعايير اختيار الوسيلة التعليمية أن تكون معقدة جداً لتناسب جميع المستويات.
الإجابة: خطأ (يجب أن تكون مناسبة للأهداف، ملائمة للمتعلمين، صادقة المعلومات، تناسب المحتوى، اقتصادية، قابلة للاستخدام المتكرر، آمنة، جميلة وجذابة)
سؤال 79: المواد الخام في تصميم الوسائل التعليمية هي الأجهزة الإلكترونية المستخدمة في العرض.
الإجابة: خطأ (هي الخامات اللازمة للإنتاج وقد تكون من البيئة أو يتم شراؤها)
سؤال 80: "الأجهزة اللازمة للإنتاج" في تصميم الوسائل التعليمية تعني:
أ. أجهزة عرض الوسائط
ب. الآلات أو الأجهزة التي تستخدم في صنع الوسيلة نفسها
ج. أجهزة الحاسوب الخاصة بالطلاب
د. الخامات والمواد الأولية
الإجابة: ب. الآلات أو الأجهزة التي تستخدم في صنع الوسيلة نفسها
سؤال 81: من خطوات تصميم الوسائل التعليمية مراعاة الأسس التربوية والنفسية مثل التعزيز والانتباه.
الإجابة: صح
سؤال 82: من مميزات شفافيات الحاسب الآلي ضمان وضوح المحتويات وجودة الإخراج.
الإجابة: صح
سؤال 83: السبورة هي لفظ يستخدم فقط للسبورة الطباشيرية التقليدية.
الإجابة: خطأ (لفظ يستخدم في كل ما يكتب عليه كالسبورة الطباشيرية، ولوحة الجيوب تعتبر "لوحة")
سؤال 84: الفكرة الأساسية للوحة الوبرية هي أن الأجسام ذات السطح الأملس تتلاصق عند تمسكها.
الإجابة: خطأ (الأجسام ذات الوبرة تتلاصق حين تمسكها)
سؤال 85: أي مما يلي يُعد من مكونات اللوحة الوبرية في شكلها النهائي؟
أ. ورق مقوى
ب. شاشة عرض
ج. قماش وبري مشدود
د. بطاقات بلاستيكية ملساء
الإجابة: ج. قماش وبري مشدود
سؤال 86: عند تحديد أبعاد الجيوب في لوحة الجيوب، يتم تحديد عمق الجيب والمسافة الأفقية بين الجيوب.
الإجابة: خطأ (عمق الجيب والمسافة الرأسية بين الجيوب)
سؤال 87: الرسوم التعليمية من حيث الحركة تنقسم إلى:
أ. شفافة ومعتمة
ب. بيانية وتوضيحية
ج. متحركة وثابتة
د. ملصقات ومصورات
الإجابة: ج. متحركة وثابتة
سؤال 88: الرسوم التعليمية الثابتة من حيث نفاذية الضوء تنقسم إلى شفافة وغير شفافة.
الإجابة: خطأ (شفافة ومعتمة)
سؤال 89: أي من أنواع الرسوم التعليمية الثابتة (الشفافة والمعتمة) يندرج تحته الأعمدة البيانية والخطوط البيانية؟
أ. الرسوم البيانية
ب. الرسوم التوضيحية
ج. الملصقات
د. المصورات
الإجابة: أ. الرسوم البيانية
سؤال 90: الملصقات التوعوية تدعو لسلوك سلبي.
الإجابة: خطأ (تدعو لسلوك إيجابي، أما التحذيرية فتحذر من موضوع معين)
سؤال 91: المصورات التعليمية تشمل رسومات وبيانات وأرقام وجداول وتعليقات لفظية.
الإجابة: صح
سؤال 92: مصور الأصول (التجميعي) يبدأ من الأصل وينتهي بالفروع.
الإجابة: خطأ (يبدأ بالفروع وينتهي بالأصل، مثل خطوات تصنيع السيارة)
sؤال 93: أي من أنواع الخرائط التالية يوضح الحدود السياسية للدول؟
أ. الخرائط الطبيعية
ب. الخرائط الاقتصادية
ج. الخرائط السياسية
د. الخرائط السكانية
الإجابة: ج. الخرائط السياسية
سؤال 94: أول خطوة في إنتاج الرسوم التعليمية هي مرحلة التنفيذ.
الإجابة: خطأ (أول خطوة هي تحديد الأهداف وصياغتها سلوكياً)
سؤال 95: من المعايير الفنية للرسم التعليمي اختيار الألوان التي تبرز الناحية الجمالية فقط حتى لو لم تبرز الأجزاء العلمية.
الإجابة: خطأ (تبرز الأجزاء العلمية أولاً ثم الناحية الجمالية)
سؤال 96: من طرق تكبير الرسوم التعليمية التكبير باستخدام جهاز عرض المواد المعتمة.
الإجابة: صح
سؤال 97: النوع الأول من العينات هو الذي يطرأ عليه بعض التغير في خصائصه.
الإجابة: خطأ (النوع الأول لا يطرأ عليه أي تغيير، النوع الثاني هو الذي يطرأ عليه تغيير)
سؤال 98: الحفظ الجاف للعينات يعتمد على إضافة محاليل كيميائية.
الإجابة: خطأ (يعتمد على تجفيف الكائن للتخلص من الرطوبة)
سؤال 99: المحلول الأولي المستخدم في الحفظ الرطب للعينات يتكون من فورمالين وماء مقطر فقط.
الإجابة: خطأ (ملح طعام، كبريتات المغنيسيوم، فورمالين، ماء مقطر)
سؤال 100: التحنيط هو طريقة شائعة الاستخدام في حفظ النباتات الصغيرة.
الإجابة: خطأ (شائعة في حفظ الحيوانات، التصبير مشابه للتحنيط ويستخدم للنبات والحشرات الصغيرة)
سؤال 101: الحفظ في البلاستيك التفاف يستخدم لعرض العينات الحية الكبيرة.
الإجابة: خطأ (لتوضيح أطوار نمو كائن معين أو للمقارنة بين أشياء مختلفة من نفس النوع)
سؤال 102: الشرائح المجهرية هي عينات كبيرة تستخدم في الدراسات العامة.
الإجابة: خطأ (هي عينات دقيقة تستخدم في الدراسات العلمية)
سؤال 103: من التسميات الأخرى للحقيبة التعليمية "رزمة تدريبية" أو "مجمع تعليمي".
الإجابة: صح
سؤال 104: تصنف الحقائب التعليمية حسب المنتج إلى:
أ. فردية وجماعية
ب. أساتذة مختصون وشركات تجارية
ج. بسيطة ومعقدة
د. تربوية وتاريخية
الإجابة: ب. أساتذة مختصون وشركات تجارية
سؤال 105: تصنف الحقائب التعليمية حسب طريقة الاستعمال إلى حقائب لمواد الرياضيات وحقائب تدريبية.
الإجابة: خطأ (حسب طريقة الاستعمال: فردي وجماعي. حسب الموضوع: تربوية، تاريخ، رياضيات، تدريبية...)
سؤال 106: من أهمية الحقائب التعليمية أنها تقلل من تفاعل المتعلم مع المعلم.
الإجابة: خطأ (تشجع التفاعل النشط بين المتعلم والمعلم، وتتيح للمتعلمين اختيار نشاطات متنوعة)
سؤال 107: من خطوات تصميم الحقائب التعليمية مرحلة "التنفيذ" التي تشمل تسلسل الفعليات والأنشطة في الحقيبة.
الإجابة: صح
سؤال 108: تحليل الاحتياجات في تصميم الحقائب التعليمية يعني تحليل محتوى المادة العلمية.
الإجابة: خطأ (لتبرير وجود الحقيبة وتحديد أهدافها)
سؤال 109: عند تحليل خصائص المستخدمين للحقيبة التعليمية، لا يهم تحديد المستوى العلمي أو الوظيفي.
الإجابة: خطأ (يهم تحديد المستوى التخصصي، العلمي، الوظيفي، مدة الخدمة، العمر، الجنس، وأية معلومات أخرى ضرورية)
سؤال 110: من أمثلة "المعدات" كمصدر أساسي في الحقيبة التعليمية، الخبراء والمستشارون.
الإجابة: خطأ (المعدات مثل أشرطة سمعية، أقراص. الخبراء يندرجون تحت "الأفراد المساعدون")
سؤال 111: تحليل "الكلفة الاقتصادية" للحقيبة التعليمية يشمل فقط تكلفة المواد الخام.
الإجابة: خطأ (يشمل الكلفة المادية لحساب كفاءتها وفاعليتها، مصادر التمويل، والجهة المشرفة على النفقات)
سؤال 112: الهدف الأدائي في الحقيبة التعليمية يتكون من الفعل الإجرائي والسلوك النهائي فقط.
الإجابة: خطأ (الفعل الإجرائي، السلوك النهائي، الشروط والظروف، معايير بلوغ الهدف)
سؤال 113: تحديد المهام التعليمية في مرحلة تحديد إنتاج برمجيات الكمبيوتر يعني تحديد خصائص المتعلمين.
الإجابة: خطأ (يعني تحديد المادة العلمية ووصفها حسب الأهداف المنوط تحقيقها)
سؤال 114: تحديد السلوك المدخلي للمتعلمين في إنتاج برمجيات الكمبيوتر يعني تحديد المهارات الجديدة التي سيتعلمونها.
الإجابة: خطأ (تحديد المعارف والمعلومات والمهارات التي يمتلكها المتعلمون بالفعل ويدخلون بها لتعلم المهام الجديدة)
سؤال 115: التنظيم المنطقي للمحتوى في برمجيات الكمبيوتر يعني الانتقال من الصعب إلى السهل.
الإجابة: خطأ (التنظيم المنطقي: تنظيم المادة وفق طبيعتها وخصائصها، مثل الانتقال من السهل إلى الصعب أو من الصغير إلى الكبير. أما الانتقال من الصعب إلى السهل فهو التنظيم الاستقرائي)
سؤال 116: التنظيم الأكاديمي للمحتوى التعليمي يعتمد على أسلوب حل المشكلات لتحقيق أهداف التعلم.
الإجابة: صح
سؤال 117: من مبادئ تصميم شاشات العرض في البرمجيات التعليمية استخدام أكبر عدد ممكن من الألوان لجذب الانتباه.
الإجابة: خطأ (تحديد عدد الألوان المستخدمة في التصميم، ومراعاة الاتساق، والبساطة)
sؤال 118: شاشة التعريف في الحقيبة التعليمية هي الشاشة التي تعرض تمارين مشابهة للمحتوى السابق.
الإجابة: خطأ (شاشة التعريف تعرض عنوان البرنامج والجهة المنتجة. شاشة المراجعة هي التي تعرض تمارين مشابهة للمحتوى السابق)
سؤال 119: مرحلة الإنتاج في برمجيات الكمبيوتر تشمل اختيار نظام التأليف (برامج تصميم الرسوم المتحركة).
الإجابة: صح
سؤال 120: تحكيم البرمجية في مرحلة التقويم يعني تجريبها على عينة من المستخدمين النهائيين.
الإجابة: خطأ (يعني عرض النسخة المبدئية على خبراء ومتخصصين في تكنولوجيا التعليم. تجريب البرمجية هو خطوة تالية)
        `;

        // --- Question Parsing Function (Robust version for qq.txt format) ---
        function parseQuestions(text) {
            const questions = [];
            const cleanText = text.replace(/^تمام، إليك \d+ سؤالاً.*?\n\n/s, '').replace(/--- START OF FILE qq.txt ---\n*/, '');
            
            const blocks = cleanText.split(/\n(?=(?:سؤال|\*\*سؤال) \d+:)/)
                                .filter(block => block.trim() !== '' && (block.includes("الإجابة:") || block.includes("**الإجابة:**")));

            blocks.forEach((block, blockIndex) => {
                block = block.trim();
                
                const qHeaderRegex = /^(?:\*\*|)(سؤال (\d+):)(?:\*\*|)/;
                const headerMatch = block.match(qHeaderRegex);

                if (!headerMatch) {
                    console.warn(`(${blockIndex + 1}) Could not parse question header for block starting with:`, block.substring(0, 100));
                    return;
                }

                const idFromFile = parseInt(headerMatch[2]);
                const fullHeaderString = headerMatch[0];
                let contentAfterHeader = block.substring(fullHeaderString.length).trim();

                const answerMarkerRegex = /\n(?:\*\*|)الإجابة:(?:\*\*|)\s*/;
                const parts = contentAfterHeader.split(answerMarkerRegex);

                if (parts.length < 2) {
                    console.warn(`(${blockIndex + 1}) Could not find answer marker for Q_file_${idFromFile}. Content after header starts with:`, contentAfterHeader.substring(0, 100));
                    return;
                }

                let rawQuestionAndOptions = parts[0].trim();
                let rawCorrectAnswerBlock = parts[1].trim(); 

                let questionText;
                let type;
                let options = {};
                let correctAnswer;

                const arabicOptionLetters = ['أ', 'ب', 'ج', 'د', 'هـ']; 
                const optionPattern = new RegExp(`^(${arabicOptionLetters.join('|')})\\.\\s*(.*?)(?=\\n(${arabicOptionLetters.join('|')})\\.\\s|\\n*$|\\r\\n(${arabicOptionLetters.join('|')})\\.\\s|\\r\\n*$)`, 'gm');

                let optionMatches = [];
                // Clean rawQuestionAndOptions from markdown before matching options and extracting questionText
                // This helps if markdown is *outside* an option's own potential markdown
                let cleanedQuestionAndOptions = rawQuestionAndOptions.replace(/\*\*(?!\s*(?:أ|ب|ج|د|هـ)\.\s)(.+?)\*\*/g, '$1').replace(/\*\*/g, '');
                
                let tempRawQuestionAndOptions = cleanedQuestionAndOptions; // Use the globally cleaned version for option matching
                let match;
                optionPattern.lastIndex = 0; 
                while ((match = optionPattern.exec(tempRawQuestionAndOptions)) !== null) {
                     // Option text itself might contain **text**, so clean it specifically
                    optionMatches.push({ letter: match[1], text: match[2].trim().replace(/\*\*(.+?)\*\*/g, '$1').replace(/\*\*/g, '') });
                }
                
                if (optionMatches.length > 0) {
                    type = 'mcq';
                    optionMatches.forEach(opt => {
                        options[opt.letter] = opt.text; // Already cleaned
                    });

                    const firstOptionLineMatchCleaned = cleanedQuestionAndOptions.match(new RegExp(`^(${arabicOptionLetters.join('|')})\\.\\s*`, 'm'));
                    if (firstOptionLineMatchCleaned) {
                        questionText = cleanedQuestionAndOptions.substring(0, firstOptionLineMatchCleaned.index).trim();
                    } else {
                        questionText = cleanedQuestionAndOptions; 
                    }
                    
                    const correctLetterMatch = rawCorrectAnswerBlock.match(new RegExp(`^(${arabicOptionLetters.join('|')})\\.`));
                    if (correctLetterMatch) {
                        correctAnswer = correctLetterMatch[1]; 
                        if (!options[correctAnswer]) {
                             console.warn(`(${blockIndex + 1}) MCQ Correct Answer letter '${correctAnswer}' not found in options for Q_file_${idFromFile}. Options:`, options, `Raw answer: ${rawCorrectAnswerBlock}`);
                        }
                    } else {
                        let cleanedFullAnswerText = rawCorrectAnswerBlock.replace(/\*\*(.+?)\*\*/g, '$1').replace(/\*\*/g, '').trim().split('(')[0].trim(); 
                        let foundKey = false;
                        for (const key in options) {
                            if (options[key] === cleanedFullAnswerText) {
                                correctAnswer = key;
                                foundKey = true;
                                break;
                            }
                        }
                        if (!foundKey) {
                            const mcqAnswerPattern = new RegExp(`^(${arabicOptionLetters.join('|')})\\.\\s*(.*)`);
                            // Try matching on the cleaned version of rawCorrectAnswerBlock
                            const mcqMatch = rawCorrectAnswerBlock.replace(/\*\*(.+?)\*\*/g, '$1').replace(/\*\*/g, '').trim().match(mcqAnswerPattern);
                            if (mcqMatch && options[mcqMatch[1]]) {
                                correctAnswer = mcqMatch[1];
                            } else {
                                console.warn(`(${blockIndex + 1}) MCQ Correct Answer text match failed for Q_file_${idFromFile}: raw='${rawCorrectAnswerBlock}', options:`, options, `Cleaned Full Answer: '${cleanedFullAnswerText}'`);
                                correctAnswer = cleanedFullAnswerText; 
                            }
                        }
                    }
                } else {
                    type = 'true_false';
                    questionText = cleanedQuestionAndOptions; 

                    let tempCorrectAnswer = rawCorrectAnswerBlock.replace(/\*\*(.+?)\*\*/g, '$1').replace(/\*\*/g, '').trim();
                    tempCorrectAnswer = tempCorrectAnswer.split('(')[0].trim(); 

                    if (tempCorrectAnswer.toLowerCase() === 'صح') {
                        correctAnswer = 'صح';
                    } else if (tempCorrectAnswer.toLowerCase() === 'خطأ') {
                        correctAnswer = 'خطأ';
                    } else {
                         console.warn(`(${blockIndex + 1}) True/False Correct Answer issue for Q_file_${idFromFile}: raw='${rawCorrectAnswerBlock}', parsed as '${tempCorrectAnswer}'`);
                         correctAnswer = tempCorrectAnswer; 
                    }
                }
                
                questionText = questionText.trim();

                questions.push({
                    id: questions.length + 1, 
                    idFromFile: idFromFile, 
                    type: type,
                    question: questionText,
                    options: options, 
                    correctAnswer: correctAnswer
                });
            });
            
            console.log("Total Parsed Questions:", questions.length, "Last ID from file:", questions.length > 0 ? questions[questions.length-1].idFromFile : "N/A");
            if (questions.length < 115 && questions.length > 0) { 
                console.warn(`Parsed ${questions.length} questions. Expected around 120. Check parsing logic, console warnings, and input text for inconsistencies.`);
            }
            return questions;
        }


        const questionsData = parseQuestions(rawQuestionsText);

        // --- DOM Elements ---
        const mainContent = document.getElementById('exam-content');
        const welcomeScreen = document.getElementById('welcome-screen'); 
        const startExamBtn = document.getElementById('start-exam-btn'); 
        const viewOldResultsBtn = document.getElementById('view-old-results-btn'); 
        
        const questionContainer = document.getElementById('question-container'); 
        const questionNumberSpan = document.getElementById('question-number');
        const questionTextElement = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const prevBtnSingleCol = document.getElementById('prev-btn'); 
        const nextBtnSingleCol = document.getElementById('next-btn'); 
        const submitBtnSingleCol = document.getElementById('submit-btn'); 
        const timerDisplaySingleCol = document.getElementById('timer'); 
        const progressBar = document.getElementById('progress-bar');

        const resultsContainer = document.getElementById('results-container'); 
        const resultsTitle = document.getElementById('results-title'); 
        const oldResultTimestampEl = document.getElementById('old-result-timestamp');
        const scoreSpan = document.getElementById('score');
        const answeredCountSpan = document.getElementById('answered-count');
        const resultsTotalQCount1 = document.getElementById('results-total-q-count1');
        const resultsTotalQCount2 = document.getElementById('results-total-q-count2');
        const percentageSpan = document.getElementById('percentage');
        const reviewBtnSingleCol = document.getElementById('review-btn'); 
        const retakeBtnSingleCol = document.getElementById('retake-btn'); 
        const backToWelcomeBtn = document.getElementById('back-to-welcome-btn');


        const reviewContainer = document.getElementById('review-container'); 
        const reviewList = document.getElementById('review-list');
        const backToResultsBtnSingleCol = document.getElementById('back-to-results-btn'); 
        
        const modalOverlay = document.getElementById('confirmation-modal-overlay');
        let modalConfirmBtn = document.getElementById('modal-confirm-btn'); 
        const modalCancelBtn = document.getElementById('modal-cancel-btn');
        const modalTitleText = document.getElementById('modal-title-text');
        const modalMessageText = document.getElementById('modal-message-text');

        // --- Exam State Variables ---
        let currentQuestionIndex = 0;
        let userAnswers = new Array(questionsData.length).fill(null);
        let score = 0;
        const ONE_HOUR_IN_SECONDS = 60 * 60; // 1 hour
        let timeLeft = ONE_HOUR_IN_SECONDS; 
        let timerInterval;
        let examActive = false;
        const OLD_RESULTS_KEY = 'examApp_oldResults';
        const EXAM_IN_PROGRESS_STATE_KEY = 'examApp_inProgressState';
        const LAST_ACTIVE_SCREEN_KEY = 'examApp_lastActiveScreen';


        // --- Screen Management ---
        function showActiveScreen(screenId) {
            const allScreens = document.querySelectorAll('#exam-content > .screen');
            allScreens.forEach(s => s.classList.add('hidden'));
            
            const activeScreenElement = document.getElementById(screenId);
            if(activeScreenElement) {
                activeScreenElement.classList.remove('hidden');
            } else {
                console.error("Screen not found:", screenId);
            }
        }
        
        // --- Modal Functions ---
        function showConfirmationModal(title, message, onConfirm) {
            modalTitleText.textContent = title;
            modalMessageText.textContent = message;
            modalOverlay.classList.add('active');
            
            const newConfirmBtn = modalConfirmBtn.cloneNode(true);
            modalConfirmBtn.parentNode.replaceChild(newConfirmBtn, modalConfirmBtn);
            modalConfirmBtn = newConfirmBtn; 

            modalConfirmBtn.onclick = () => { 
                onConfirm();
                hideConfirmationModal();
            };
        }
        function hideConfirmationModal() { modalOverlay.classList.remove('active'); }

        // --- In-Progress State Management ---
        function saveInProgressState() {
            if (!examActive || questionsData.length === 0) return;
            const state = {
                answers: userAnswers,
                currentIndex: currentQuestionIndex,
                timeLeft: timeLeft,
                totalQuestions: questionsData.length // Save total questions for validation
            };
            localStorage.setItem(EXAM_IN_PROGRESS_STATE_KEY, JSON.stringify(state));
        }

        function loadInProgressState() {
            const savedStateJSON = localStorage.getItem(EXAM_IN_PROGRESS_STATE_KEY);
            if (savedStateJSON) {
                try {
                    const savedState = JSON.parse(savedStateJSON);
                    // Validate if the saved state is for the current number of questions
                    if (savedState.answers && savedState.answers.length === questionsData.length && savedState.totalQuestions === questionsData.length) {
                        userAnswers = savedState.answers;
                        currentQuestionIndex = savedState.currentIndex;
                        timeLeft = savedState.timeLeft;
                        if (timeLeft <=0 ) { // If loaded time is already zero or less, treat as expired.
                           timeLeft = 0; //normalize
                           return 'expired'; // Special return value
                        }
                        return true; // Successfully loaded
                    } else {
                        console.warn("Saved progress is for a different number of questions. Discarding.");
                        localStorage.removeItem(EXAM_IN_PROGRESS_STATE_KEY); // Clear invalid state
                    }
                } catch (e) {
                    console.error("Error parsing saved state:", e);
                    localStorage.removeItem(EXAM_IN_PROGRESS_STATE_KEY); // Clear corrupted state
                }
            }
            return false; // No valid state loaded
        }

        // --- Functions ---
        function startExam() {
            let loadedState = loadInProgressState();
            let calculatedTimePerQuestion = questionsData.length > 0 ? questionsData.length * 30 : ONE_HOUR_IN_SECONDS;
            let examDuration = Math.max(ONE_HOUR_IN_SECONDS, calculatedTimePerQuestion);


            if (loadedState === true) { // Resuming a valid, non-expired session
                examActive = true;
                // timeLeft, currentQuestionIndex, userAnswers are already set by loadInProgressState()
                console.log("Resuming exam session.");
            } else if (loadedState === 'expired') { // Resuming an expired session
                 examActive = true; // Still set active to allow immediate submission display
                 console.log("Resuming an expired exam session. Submitting immediately.");
                 // userAnswers and currentQuestionIndex are set. timeLeft is 0.
            } else { // Fresh start
                examActive = true;
                timeLeft = examDuration; // Use the determined exam duration
                currentQuestionIndex = 0;
                userAnswers = new Array(questionsData.length).fill(null);
                score = 0;
                console.log("Starting a new exam session.");
            }
            
            document.querySelector('#welcome-time-duration').textContent = `${Math.floor(timeLeft / 60)} دقيقة`;
            showActiveScreen('question-container');
            localStorage.setItem(LAST_ACTIVE_SCREEN_KEY, 'question');
            startTimer(); // Will use the (potentially restored) timeLeft
            displayQuestion(); // Will display the (potentially restored) currentQuestionIndex
        }


        function displayQuestion() {
            if (!examActive || currentQuestionIndex >= questionsData.length) {
                 if (examActive && currentQuestionIndex >= questionsData.length && questionsData.length > 0) {
                     if (timeLeft > 0) submitExam(); // Auto-submit if navigated past last question with time left
                     else if (!timerInterval) submitExam(true); // Auto-submit if time ran out before navigating past
                 }
                return;
            }
            const question = questionsData[currentQuestionIndex];
            if (!question) return;

            questionNumberSpan.textContent = `السؤال ${currentQuestionIndex + 1} / ${questionsData.length}`;
            questionTextElement.textContent = question.question;
            optionsContainer.innerHTML = '';

            if (question.type === 'mcq') {
                const optionKeys = Object.keys(question.options).sort();
                optionKeys.forEach(key => {
                    const optionText = question.options[key];
                    const optionDiv = document.createElement('label');
                    optionDiv.className = 'option-item';
                    optionDiv.innerHTML = `
                        <input type="radio" name="question${currentQuestionIndex}" value="${key}" id="option-${currentQuestionIndex}-${key}">
                        <span class="custom-radio"></span>
                        <span>${key}. ${optionText}</span>
                    `;
                    optionsContainer.appendChild(optionDiv);
                    if (userAnswers[currentQuestionIndex] === key) {
                        optionDiv.classList.add('selected');
                        optionDiv.querySelector('input').checked = true;
                    }
                    optionDiv.addEventListener('click', () => {
                        document.querySelectorAll(`#options-container input[name="question${currentQuestionIndex}"]`).forEach(input => {
                            input.closest('.option-item').classList.remove('selected');
                        });
                        optionDiv.classList.add('selected');
                        optionDiv.querySelector('input').checked = true;
                        selectOption(key);
                    });
                });
            } else if (question.type === 'true_false') {
                ['صح', 'خطأ'].forEach(option => {
                    const optionDiv = document.createElement('label');
                    optionDiv.className = 'option-item';
                    optionDiv.innerHTML = `
                        <input type="radio" name="question${currentQuestionIndex}" value="${option}" id="option-${currentQuestionIndex}-${option}">
                        <span class="custom-radio"></span>
                        <span>${option}</span>
                    `;
                    optionsContainer.appendChild(optionDiv);
                    if (userAnswers[currentQuestionIndex] === option) {
                        optionDiv.classList.add('selected');
                        optionDiv.querySelector('input').checked = true;
                    }
                    optionDiv.addEventListener('click', () => {
                        document.querySelectorAll(`#options-container input[name="question${currentQuestionIndex}"]`).forEach(input => {
                            input.closest('.option-item').classList.remove('selected');
                        });
                        optionDiv.classList.add('selected');
                        optionDiv.querySelector('input').checked = true;
                        selectOption(option);
                    });
                });
            }
            updateNavigationButtonsSingleCol();
            updateProgressBar();
        }
        
        function selectOption(value) {
            userAnswers[currentQuestionIndex] = value;
            saveInProgressState(); // Save state after every selection
        }

        function updateNavigationButtonsSingleCol() {
            prevBtnSingleCol.disabled = currentQuestionIndex === 0;
            nextBtnSingleCol.classList.toggle('hidden', currentQuestionIndex === questionsData.length - 1);
            submitBtnSingleCol.classList.toggle('hidden', currentQuestionIndex !== questionsData.length - 1);
        }

        function showPreviousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayQuestion();
                saveInProgressState(); // Save state after navigation
            }
        }

        function showNextQuestion() {
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveInProgressState(); // Save state after navigation
            }
        }

        function updateProgressBar() {
            const progress = questionsData.length > 0 ? ((currentQuestionIndex + 1) / questionsData.length) * 100 : 0;
            progressBar.style.width = `${progress}%`;
        }

        function startTimer() {
            clearInterval(timerInterval); // Clear any existing timer
            timerDisplaySingleCol.innerHTML = `<i class="fa-solid fa-clock-rotate-left"></i> الزمن المتبقي: ${formatTime(timeLeft)}`;
            
            if(timeLeft <= 0 && examActive) { // If time is already up when timer starts
                timerDisplaySingleCol.innerHTML = '<i class="fa-solid fa-hourglass-end"></i> انتهى الوقت!';
                submitExam(true); // Force submit if time is already up
                return;
            }

            timerInterval = setInterval(() => {
                timeLeft--;
                timerDisplaySingleCol.innerHTML = `<i class="fa-solid fa-clock-rotate-left"></i> الزمن المتبقي: ${formatTime(timeLeft)}`;
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    timerInterval = null; // Ensure timerInterval is null after clearing
                    timerDisplaySingleCol.innerHTML = '<i class="fa-solid fa-hourglass-end"></i> انتهى الوقت!';
                    if (examActive) submitExam(true); 
                }
            }, 1000);
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
        }

        function confirmAndSubmitExam() { 
            showConfirmationModal(
                'تأكيد تسليم الإجابات النهائية',
                'بمجرد التأكيد، سيتم تسجيل إجاباتك ولا يمكن تغييرها. هل أنت مستعد للمتابعة؟',
                () => submitExam(false) 
            );
        }

        function submitExam(timeUp = false) {
            if (!examActive && !timeUp) return; 

            clearInterval(timerInterval);
            timerInterval = null; 
            examActive = false; 
            score = 0;
            let answeredCount = 0;
            questionsData.forEach((question, index) => {
                const userAnswer = userAnswers[index];
                if (userAnswer !== null) {
                    answeredCount++;
                    if (userAnswer === question.correctAnswer) {
                        score++;
                    }
                }
            });

            const currentResults = {
                score: score,
                answeredCount: answeredCount,
                totalQuestions: questionsData.length,
                percentage: questionsData.length > 0 ? (score / questionsData.length) * 100 : 0,
                timestamp: new Date().toLocaleString('ar-EG'),
                userAnswersForReview: userAnswers // Save answers for review
            };
            localStorage.setItem(OLD_RESULTS_KEY, JSON.stringify(currentResults));
            localStorage.removeItem(EXAM_IN_PROGRESS_STATE_KEY); 
            localStorage.setItem(LAST_ACTIVE_SCREEN_KEY, 'results');

            displayResults(currentResults, { isPostSubmit: true, showReview: true }); 
        }

        function displayResults(resultsData, options = { isPostSubmit: false, showReview: false }) {
            showActiveScreen('results-container');
            answeredCountSpan.textContent = resultsData.answeredCount;
            scoreSpan.textContent = resultsData.score;
            resultsTotalQCount1.textContent = resultsData.totalQuestions;
            resultsTotalQCount2.textContent = resultsData.totalQuestions;
            percentageSpan.textContent = `النسبة المئوية للإتقان: ${resultsData.percentage.toFixed(1)}%`;

            if (options.isPostSubmit) { // True if called from submitExam or restoring to last results page
                resultsTitle.innerHTML = `<i class="fa-solid fa-medal"></i> تقرير الأداء النهائي`;
                retakeBtnSingleCol.classList.remove('hidden');
                backToWelcomeBtn.classList.add('hidden');
                oldResultTimestampEl.classList.add('hidden');
            } else {  // Called from "View Old Results"
                resultsTitle.innerHTML = `<i class="fa-solid fa-history"></i> نتيجة سابقة`;
                retakeBtnSingleCol.classList.add('hidden'); 
                backToWelcomeBtn.classList.remove('hidden');
                if (resultsData.timestamp) {
                    oldResultTimestampEl.textContent = `تم إكمال هذا الاختبار في: ${resultsData.timestamp}`;
                    oldResultTimestampEl.classList.remove('hidden');
                } else {
                     oldResultTimestampEl.classList.add('hidden');
                }
            }

            if(options.showReview && resultsData.userAnswersForReview) {
                reviewBtnSingleCol.classList.remove('hidden');
            } else {
                reviewBtnSingleCol.classList.add('hidden');
            }
        }


        function showReviewScreen() {
            // userAnswers should be populated by submitExam or by DOMContentLoaded restore
            if (!userAnswers || userAnswers.every(ans => ans === null) && questionsData.length > 0) {
                // Attempt to load from last completed exam if global userAnswers is empty
                const lastExamDataJSON = localStorage.getItem(OLD_RESULTS_KEY);
                if (lastExamDataJSON) {
                    const lastExamData = JSON.parse(lastExamDataJSON);
                    if (lastExamData.userAnswersForReview) {
                        userAnswers = lastExamData.userAnswersForReview;
                    } else {
                         console.warn("Review attempted but no answers found in memory or storage for last exam.");
                         showResultsScreen(); // Go back to results as review is not possible
                         return;
                    }
                } else {
                    console.warn("Review attempted but no answers found in memory and no last exam data.");
                    showResultsScreen();
                    return;
                }
            }


            showActiveScreen('review-container');
            localStorage.setItem(LAST_ACTIVE_SCREEN_KEY, 'review');
            reviewList.innerHTML = '';
            questionsData.forEach((question, index) => {
                const reviewItemDiv = document.createElement('div');
                reviewItemDiv.className = 'review-item'; 
                const userAnswerFromStore = userAnswers[index]; // Use the (potentially restored) userAnswers
                const isCorrect = (userAnswerFromStore !== null && userAnswerFromStore === question.correctAnswer);

                if (userAnswerFromStore === null) {
                    reviewItemDiv.classList.add('review-item-unanswered');
                } else if (isCorrect) {
                    reviewItemDiv.classList.add('review-item-correct');
                } else {
                    reviewItemDiv.classList.add('review-item-incorrect');
                }
                
                let userAnswerText = 'لم تتم الإجابة';
                if (userAnswerFromStore !== null) {
                    userAnswerText = `إجابتك: ${userAnswerFromStore}`;
                    if (question.type === 'mcq' && question.options[userAnswerFromStore]) {
                        userAnswerText += `. ${question.options[userAnswerFromStore]}`;
                    }
                }
                let correctAnswerDisplay = `الإجابة الصحيحة: ${question.correctAnswer}`;
                if (question.type === 'mcq' && question.options[question.correctAnswer]) {
                    correctAnswerDisplay += `. ${question.options[question.correctAnswer]}`;
                }
                
                let resultFeedbackHtml = '';
                if (userAnswerFromStore !== null) { 
                    if (isCorrect) {
                        resultFeedbackHtml = `<p class="correct-answer-review">إجابة صحيحة!</p>`;
                    } else {
                        resultFeedbackHtml = `<p class="correct-answer-review">${correctAnswerDisplay}</p>`;
                    }
                }

                reviewItemDiv.innerHTML = `
                    <p class="question-text-review"><strong>سؤال ${index + 1}:</strong> ${question.question}</p>
                    <p class="your-answer-review">${userAnswerText}</p>
                    ${resultFeedbackHtml}
                `;
                reviewList.appendChild(reviewItemDiv);
            });
        }

        function showResultsScreen() { // Called when going back from review
            showActiveScreen('results-container');
            localStorage.setItem(LAST_ACTIVE_SCREEN_KEY, 'results');
        }

        function resetExam() {
            localStorage.removeItem(EXAM_IN_PROGRESS_STATE_KEY); 
            localStorage.setItem(LAST_ACTIVE_SCREEN_KEY, 'welcome');
            showActiveScreen('welcome-screen');
            
            let calculatedTimePerQuestion = questionsData.length > 0 ? questionsData.length * 30 : ONE_HOUR_IN_SECONDS;
            let examDuration = Math.max(ONE_HOUR_IN_SECONDS, calculatedTimePerQuestion);
            timeLeft = examDuration;

            timerDisplaySingleCol.innerHTML = `<i class="fa-solid fa-clock-rotate-left"></i> الزمن المتبقي: ${formatTime(timeLeft)}`;
            document.querySelector('#welcome-time-duration').textContent = `${Math.floor(timeLeft/60)} دقيقة`; 
            progressBar.style.width = '0%';
            clearInterval(timerInterval); 
            timerInterval = null;
            examActive = false; 
        }
        
        function showOldResults() {
            const savedResultsJSON = localStorage.getItem(OLD_RESULTS_KEY);
            if (savedResultsJSON) {
                const oldData = JSON.parse(savedResultsJSON);
                const canReviewThis = !!(oldData && oldData.userAnswersForReview);
                
                if (canReviewThis) { // If these old results have answers, load them for potential review
                    userAnswers = oldData.userAnswersForReview;
                } else { // Otherwise, clear global userAnswers or set to empty
                    userAnswers = new Array(questionsData.length).fill(null);
                }
                displayResults(oldData, { isPostSubmit: false, showReview: canReviewThis }); 
            } else {
                 showConfirmationModal(
                    'لا توجد نتائج سابقة',
                    'لم يتم العثور على أي نتائج اختبارات سابقة محفوظة في هذا المتصفح.',
                    () => {} 
                );
                const confirmBtnForInfo = document.getElementById('modal-confirm-btn');
                if(confirmBtnForInfo) confirmBtnForInfo.textContent = 'موافق';
            }
        }

        // --- Event Listeners ---
        startExamBtn.addEventListener('click', startExam);
        viewOldResultsBtn.addEventListener('click', showOldResults); 
        prevBtnSingleCol.addEventListener('click', showPreviousQuestion);
        nextBtnSingleCol.addEventListener('click', showNextQuestion);
        submitBtnSingleCol.addEventListener('click', confirmAndSubmitExam); 
        reviewBtnSingleCol.addEventListener('click', showReviewScreen);
        retakeBtnSingleCol.addEventListener('click', resetExam);
        backToResultsBtnSingleCol.addEventListener('click', showResultsScreen);
        backToWelcomeBtn.addEventListener('click', () => {
            showActiveScreen('welcome-screen');
            localStorage.setItem(LAST_ACTIVE_SCREEN_KEY, 'welcome');
        }); 
        
        modalCancelBtn.addEventListener('click', hideConfirmationModal);
        modalOverlay.addEventListener('click', (event) => {
            if (event.target === modalOverlay) {
                hideConfirmationModal();
            }
        });

        window.addEventListener('beforeunload', () => {
            if (examActive && questionsData.length > 0) {
                saveInProgressState();
            }
        });


        document.addEventListener('DOMContentLoaded', () => {
            if (questionsData.length === 0) {
                console.error("No questions were parsed. Check console for parsing warnings.");
                document.body.innerHTML = "<div style='color:var(--text-primary); text-align:center; padding: 50px; font-size:1.5em; font-family: var(--font-main);'>حدث خطأ في تحميل الأسئلة. يرجى التحقق من وحدة التحكم (Console) لمزيد من التفاصيل وتحديث الصفحة أو الاتصال بالدعم.</div>";
                return;
            }
            
            const welcomeP1 = document.querySelector('#welcome-screen p:nth-of-type(1)');
            if (welcomeP1) {
                welcomeP1.textContent = `انطلق في رحلة معرفية مع ${questionsData.length} سؤالاً مصممة لاختبار حدود فهمك. التركيز هو مفتاحك للنجاح.`;
            }
            
            let calculatedTimePerQuestion = questionsData.length > 0 ? questionsData.length * 30 : ONE_HOUR_IN_SECONDS;
            let initialTime = Math.max(ONE_HOUR_IN_SECONDS, calculatedTimePerQuestion);
            timerDisplaySingleCol.innerHTML = `<i class="fa-solid fa-clock-rotate-left"></i> الزمن المتبقي: ${formatTime(initialTime)}`;
            document.querySelector('#welcome-time-duration').textContent = `${Math.floor(initialTime / 60)} دقيقة`;

            // --- Restore state on page load ---
            const inProgressStateLoaded = loadInProgressState(); // This also sets global vars if successful
            const lastScreen = localStorage.getItem(LAST_ACTIVE_SCREEN_KEY);
            const lastCompletedExamJSON = localStorage.getItem(OLD_RESULTS_KEY);
            let lastCompletedExamData = null;
            if(lastCompletedExamJSON) lastCompletedExamData = JSON.parse(lastCompletedExamJSON);


            if (inProgressStateLoaded === true || inProgressStateLoaded === 'expired') {
                startExam(); // This will handle resuming or submitting expired exam
            } else if (lastScreen === 'results' && lastCompletedExamData) {
                if (lastCompletedExamData.userAnswersForReview) {
                    userAnswers = lastCompletedExamData.userAnswersForReview;
                } else {
                    userAnswers = new Array(questionsData.length).fill(null);
                }
                displayResults(lastCompletedExamData, { isPostSubmit: true, showReview: !!lastCompletedExamData.userAnswersForReview });
                showActiveScreen('results-container');
            } else if (lastScreen === 'review' && lastCompletedExamData && lastCompletedExamData.userAnswersForReview) {
                userAnswers = lastCompletedExamData.userAnswersForReview;
                showReviewScreen(); // This also sets the active screen
            }
            else {
                showActiveScreen('welcome-screen');
                localStorage.setItem(LAST_ACTIVE_SCREEN_KEY, 'welcome');
            }
        });
    </script>
</body>
</html>
